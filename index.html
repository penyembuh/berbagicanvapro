<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Form Input Email</title>
  <style>
    :root { --bg:#0f172a; --muted:#9ca3af; --text:#e5e7eb; --accent:#22c55e; --danger:#ef4444; }
    *{box-sizing:border-box} body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; background:linear-gradient(180deg,#0b1220,#0f172a 30%);}
    .container{min-height:100dvh; display:grid; place-items:center; padding:24px}
    .card{width:min(520px,100%); background:rgba(17,24,39,.85); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.45)}
    h1{margin:0 0 6px; color:var(--text); font-size:24px; letter-spacing:.3px}
    p{margin:0 0 18px; color:var(--muted); font-size:14px}
    label{display:block; color:var(--text); font-weight:600; margin-bottom:8px}
    input[type=email]{width:100%; background:#0b1020; border:1px solid #1f2937; color:var(--text); padding:12px 14px; border-radius:10px; outline:none; font-size:16px}
    input[type=email]:focus{border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .row{display:flex; gap:10px; align-items:center; margin-top:14px}
    button{appearance:none; border:0; background:var(--accent); color:#0b1020; font-weight:700; padding:12px 16px; border-radius:10px; cursor:pointer}
    button[disabled]{opacity:.6; cursor:not-allowed}
    .msg{margin-left:8px; font-size:14px}
    .ok{color:#86efac} .err{color:var(--danger)}
    .toolbar{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:18px}
    table{width:100%; border-collapse:collapse; margin-top:10px}
    th,td{padding:10px 12px; border-bottom:1px solid #1f2937; color:var(--text); font-size:14px}
    th{color:#cbd5e1; text-align:left; font-weight:700}
    footer{margin-top:16px; color:#94a3b8; font-size:12px}
    .small{font-size:12px; color:#9ca3af}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Form Input Email</h1>
      <p>Masukkan email yang akan diundang ke tim Canva Pro. Data otomatis tercatat ke Google Sheets.</p>

      <form id="emailForm" novalidate>
        <label for="email">Alamat Email</label>
        <input id="email" name="email" type="email" placeholder="nama@email.com" required />
        <div class="row">
          <button id="submitBtn" type="submit">Kirim</button>
          <span id="status" class="msg" aria-live="polite"></span>
        </div>
        <p class="small">Dengan mengirim, Anda menyetujui email dicatat untuk proses undangan tim.</p>
      </form>

      <div class="toolbar">
        <h2 style="margin:0;color:var(--text);font-size:18px">Daftar Email Terkirim</h2>
        <div><button type="button" id="refreshBtn" style="background:#0b1020;color:#cbd5e1;border:1px solid #1f2937">Muat Ulang</button></div>
      </div>
      <table id="emailTable" aria-live="polite">
        <thead><tr><th style="width:45%">Email</th><th>Waktu</th></tr></thead>
        <tbody id="emailTbody"><tr><td colspan="2" class="small">Memuat data…</td></tr></tbody>
      </table>

      <footer>© <span id="year"></span> — Form Canva Pro</footer>
    </div>
  </div>

  <script>
    // === GANTI URL WEB APP ANDA DI SINI (akhiran /exec) ===
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwhsa0fnrVi4kWwwLFE467fhbNX6AMWv_kc4H-LGnKMsemADppTHzIudYzq_8Vw0INoAQ/exec";

    document.getElementById('year').textContent = new Date().getFullYear();

    // Helper JSONP
    function jsonp(url){
      return new Promise((resolve, reject)=>{
        const cb = '__cb_' + Math.random().toString(36).slice(2);
        const sep = url.includes('?') ? '&' : '?';
        const src = url + sep + 'callback=' + cb + '&_=' + Date.now();
        const s = document.createElement('script');
        window[cb] = (data)=>{ cleanup(); resolve(data); };
        function cleanup(){ delete window[cb]; if(s && s.parentNode) s.parentNode.removeChild(s); }
        s.src = src;
        s.onerror = ()=>{ cleanup(); reject(new Error('Gagal memuat')); };
        document.body.appendChild(s);
      });
    }

    // UI refs
    const f = document.getElementById('emailForm');
    const input = document.getElementById('email');
    const btn = document.getElementById('submitBtn');
    const statusEl = document.getElementById('status');
    const tbody = document.getElementById('emailTbody');
    const refreshBtn = document.getElementById('refreshBtn');

    function setStatus(text, ok=true){
      statusEl.textContent = text;
      statusEl.className = 'msg ' + (ok ? 'ok' : 'err');
    }

    async function loadList(){
      try{
        tbody.innerHTML = '<tr><td colspan="2" class="small">Memuat data…</td></tr>';
        const data = await jsonp(WEB_APP_URL + '?action=list&limit=50');
        tbody.innerHTML = '';
        const rows = (data && data.rows) || [];
        if(rows.length === 0){
          tbody.innerHTML = '<tr><td colspan="2" class="small">Belum ada data.</td></tr>';
          return;
        }
        for(const r of rows){
          const tr = document.createElement('tr');
          const tdEmail = document.createElement('td');
          const tdTime = document.createElement('td');
          tdEmail.textContent = r.email || '-';
          tdTime.textContent = r.timestamp || '-';
          tr.appendChild(tdEmail);
          tr.appendChild(tdTime);
          tbody.appendChild(tr);
        }
      }catch(err){
        tbody.innerHTML = '<tr><td colspan="2" class="small">'+(err.message || 'Gagal memuat')+'</td></tr>';
      }
    }

    f.addEventListener('submit', async (e)=>{
      e.preventDefault();
      setStatus('');
      const email = (input.value || '').trim();
      if(!email){ setStatus('Email wajib diisi', false); input.focus(); return; }
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ setStatus('Format email tidak valid', false); input.focus(); return; }

      btn.disabled = true; btn.textContent = 'Mengirim…';
      try{
        const data = await jsonp(WEB_APP_URL + '?action=add&email=' + encodeURIComponent(email));
        if(data && data.ok){
          setStatus('Berhasil! Email sudah tercatat.');
          f.reset();
          loadList();
        }else{
          setStatus((data && data.message) || 'Gagal mencatat.', false);
        }
      }catch(err){
        setStatus(err.message || 'Gagal mengirim.', false);
      }finally{
        btn.disabled = false; btn.textContent = 'Kirim';
      }
    });

    refreshBtn.addEventListener('click', (e)=>{ e.preventDefault(); loadList(); });
    loadList();
  </script>
</body>
</html>
