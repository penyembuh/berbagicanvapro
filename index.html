<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daftar Email Canva Pro (Maks 50)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-50 flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <div class="bg-white rounded-2xl shadow-lg p-6">
      <h1 class="text-2xl font-bold tracking-tight">Daftar Email Canva Pro</h1>
      <p class="text-sm text-slate-600 mt-1">Masukkan email yang akan diundang ke tim Canva Pro. Batas maksimal <span class="font-semibold">50</span> alamat.</p>

```
  <div id="status" class="mt-3 text-sm text-slate-700 hidden"></div>

  <form id="emailForm" class="mt-4 space-y-4">
    <div>
      <label for="access" class="block text-sm font-medium">Kode Akses (opsional)</label>
      <input id="access" name="access" type="text" placeholder="Masukkan kode jika diminta" class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400" />
    </div>

    <div>
      <label for="email" class="block text-sm font-medium">Email</label>
      <input id="email" name="email" type="email" required placeholder="nama@domain.com" class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-400" />
    </div>

    <button type="submit" class="w-full rounded-xl bg-slate-900 text-white py-2.5 font-medium hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed">Kirim</button>
  </form>

  <div class="mt-4 text-sm text-slate-700">
    <span class="font-semibold">Terdaftar:</span> <span id="count">–</span>/50
  </div>

  <div id="limitBanner" class="mt-3 hidden rounded-xl border border-amber-300 bg-amber-50 text-amber-800 p-3 text-sm">
    Kuota sudah penuh (50/50). Formulir dinonaktifkan.
  </div>
</div>

<p class="text-center text-xs text-slate-500 mt-4">© <span id="year"></span> — Canva Pro Intake</p>
```

  </div>

  <script>
    // ======= KONFIGURASI =======
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwM7eXvwp1VkOp1mnAryz01O7PXy482_JlirOmoOveSIok5ROsESXwLFXBQiQjEumuz4Q/exec"; // ganti setelah deploy Apps Script

    const statusEl = document.getElementById('status');
    const countEl = document.getElementById('count');
    const formEl = document.getElementById('emailForm');
    const emailEl = document.getElementById('email');
    const accessEl = document.getElementById('access');
    const limitBanner = document.getElementById('limitBanner');

    const setStatus = (msg, ok=true) => {
      statusEl.classList.remove('hidden');
      statusEl.className = `mt-3 text-sm p-3 rounded-xl ${ok ? 'bg-emerald-50 text-emerald-800 border border-emerald-200' : 'bg-rose-50 text-rose-800 border border-rose-200'}`;
      statusEl.textContent = msg;
    };

    const setDisabled = (disabled) => {
      [...formEl.elements].forEach(el => el.disabled = disabled);
    };

    const refreshCount = async () => {
      try {
        const r = await fetch(WEB_APP_URL + '?mode=count');
        const data = await r.json();
        countEl.textContent = data.count ?? '0';
        if (data.count >= 50) {
          setDisabled(true);
          limitBanner.classList.remove('hidden');
        }
      } catch (e) {
        // ignore error
      }
    };

    // ======= INIT =======
    document.getElementById('year').textContent = new Date().getFullYear();
    refreshCount();

    // ======= SUBMIT =======
    formEl.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = emailEl.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
      if (!emailRegex.test(email)) {
        setStatus('Format email tidak valid.', false);
        return;
      }

      try {
        setDisabled(true);
        setStatus('Memproses…');

        const form = new URLSearchParams();
        form.set('email', email);
        form.set('access', accessEl.value || '');

        const r = await fetch(WEB_APP_URL, {
          method: 'POST',
          body: form // tidak pakai headers agar tidak preflight CORS
        });

        const data = await r.json();
        if (data.ok) {
          setStatus('Berhasil disimpan. Cek email undangan dari Canva Pro (jika sudah dikirim oleh admin).', true);
          emailEl.value = '';
          accessEl.value = '';
          await refreshCount();
        } else {
          setStatus(data.message || 'Gagal menyimpan.', false);
        }
      } catch (err) {
        setStatus('Terjadi kesalahan jaringan. Coba lagi.', false);
      } finally {
        setDisabled(false);
      }
    });
  </script>

</body>
</html>
